function initMap(){function e(e,t){function a(a,o){if(o==google.maps.StreetViewStatus.OK){var l=a.location.latLng,r=google.maps.geometry.spherical.computeHeading(l,e.position);t.setContent("<div>"+e.title+'</div><div id="pano"></div>');var i={position:l,pov:{heading:r,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),i)}else t.setContent("<div>"+e.title+"</div><div>No Street View Found</div>")}if(t.marker!=e){t.setContent("<div>"+e.title+"</div>"),t.marker=e,t.addListener("closeclick",function(){t.close(map,e)});var o=new google.maps.StreetViewService,l=50;o.getPanoramaByLocation(e.position,l,a),t.open(map,e);var r=$("#wikipedia-links"),i="http://en.wikipedia.org/w/api.php?action=opensearch&search="+e.title+"$format=json&callback=wikiCallback";setTimeout(function(){r.text("failed to get Wikipedia resources")},8e3),console.log("Wiki Request"),$.ajax({url:i,dataType:"jsonp"}).done(function(r){var i=(r[1],"http://en.wikipedia.org/wiki/"+e.title);o.getPanoramaByLocation(e.position,l,a),t.setContent("<div>"+e.title+'</div><br><a href ="'+i+'">'+i+'</a><hr><div id="pano"></div>')}),t.setContent("<div>"+e.title+"</div>"),t.open(map,e)}}function t(){for(var e=new google.maps.LatLngBounds,t=0;t<markers.length;t++)markers[t].setMap(map),markers[t].setVisible(!0),e.extend(markers[t].position);map.fitBounds(e)}function a(){for(var e=0;e<markers.length;e++)markers[e].setMap(null)}map=new google.maps.Map(document.getElementById("map"),{center:{lat:21.7679,lng:78.8718},zoom:13,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]});var o=[{title:"Amrut Hotel Karwar",location:{lat:14.809,lng:74.1303}},{title:"LakeView Hotel Hubli",location:{lat:15.371598,lng:75.101166}},{title:"Mysore Palace Mysuru",location:{lat:12.3051,lng:76.6551}},{title:"Hampi, Karnataka",location:{lat:15.335,lng:76.46}},{title:"Madikeri, Karnataka",location:{lat:12.4244,lng:75.7382}},{title:"Udupi, Karnataka",location:{lat:13.3409,lng:74.7421}}];largeInfowindow=new google.maps.InfoWindow;for(var l=new google.maps.LatLngBounds,r=0;r<o.length;r++){var i=o[r].location,n=o[r].title,s=new google.maps.Marker({position:i,title:n,animation:google.maps.Animation.DROP,id:r});o[r].marker=s,markers.push(s),l.extend(s.position),s.addListener("click",function(){e(this,largeInfowindow)})}document.getElementById("show-listings").addEventListener("click",t),document.getElementById("hide-listings").addEventListener("click",a),ko.applyBindings(viewModel)}function check(){setMap(markers,i)}var map,markers=[],locations=[{title:"Amrut Hotel Karwar",lat:14.809,lng:74.1303,Address:"State Highway 6, Near Geethanjali Theater, Konekar Wada, Karwar, Karnataka 581301",visible:ko.observable(!0),test:!0},{title:"LakeView Hotel Hubli",lat:15.371598,lng:75.101166,Address:"The Gateway Hotel Lakeside,Unkal Lake, Hubli, Karnataka 580025",visible:ko.observable(!0),test:!0},{title:"Mysore Palace Mysuru",lat:12.3051,lng:76.6551,Address:"Sayyaji Rao Rd, Agrahara, Chamrajpura, Mysuru, Karnataka 570001",visible:ko.observable(!0),test:!0},{title:"Hampi, Karnataka",lat:15.335,lng:76.46,Address:"Hampi, Karnataka 583239",visible:ko.observable(!0),test:!0},{title:"Madikeri, Karnataka",lat:12.4244,lng:75.7382,Address:"Madikeri, Karnataka 571201",visible:ko.observable(!0),test:!0},{title:"Udupi, Karnataka",lat:13.3408807,lng:74.7421427,Address:"Udupi, Karnataka 576101",visible:ko.observable(!0),test:!0}],largeInfowindow,googleError=function(){alert("Error connecting to Google Maps. Please try again later.")},viewModel={query:ko.observable(""),marker:ko.observableArray(locations),clickHandlerFunction:function(e){largeInfowindow.setContent(location.contentString),largeInfowindow.open(map,location.placeMarker),map.setZoom(16),location.placeMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){location.placeMarker.setAnimation(null)},700),map.setCenter(location.placeMarker.getPosition())}};viewModel.visible=ko.observable(!0),viewModel.markers=ko.dependentObservable(function(){var e=this,t=e.query().toLowerCase();return viewModel.marker().forEach(function(e,a){var o=e.title.toLowerCase().indexOf(t)>=0;e.test=o,e.visible(o),markers.length>0&&markers[a].setVisible(o)})},viewModel);